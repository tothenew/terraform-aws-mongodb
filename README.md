# terraform-aws-mongodb

[![Lint Status](https://github.com/tothenew/terraform-aws-mongodb/workflows/Lint/badge.svg)](https://github.com/tothenew/terraform-aws-mongodb/actions)
[![LICENSE](https://img.shields.io/github/license/tothenew/terraform-aws-mongodb)](https://github.com/tothenew/terraform-aws-mongodb/blob/master/LICENSE)

The following content needed to be created and managed:
 - Introduction
     - This Terraform module automates the provisioning of a **MongoDB Replica Set** on AWS using EC2 instances. It handles everything from secure key generation to EBS volume attachment, replica set configuration, and SSM-based credential storage. The design ensures a secure, private, and production-aligned MongoDB deployment across multiple Availability Zones.

 - This module creates and configures the following AWS resources:

- `aws_instance` â€“ EC2 instances for MongoDB nodes  
- `aws_ebs_volume` and `aws_volume_attachment` â€“ Storage volumes  
- `aws_security_group` â€“ Allow SSH (22), MongoDB (27017), and internal node communication  
- `aws_ssm_parameter` â€“ Securely stores MongoDB admin credentials  
- `aws_iam_instance_profile` and `aws_iam_role` â€“ Enables EC2 SSM connectivity  
---

## ðŸ’¡ Example Usage

```hcl
module "mongodb_replica_set" {
  source                = "./modules/mongodb-replicaset"
  region                = "us-east-1"
  mongo_ami             = "ami-0149b2da6ceec4bb0"
  primary_node_type     = "t3.medium"
  secondary_node_type   = "t3.small"
  volume_type           = "gp3"
  volume_size           = 50
  vpc_id                = "vpc-12345678"
  mongo_subnet_id       = "subnet-87654321"
  mongo_database        = "admin"
  mongo_username        = "admin"
  key_name              = "mongo-keypair"
  instance_user         = "ubuntu"
  environment           = "dev"
  replica_set_name      = "mongoRs"
  num_secondary_nodes   = 2
  domain_name           = ".test.internal"
  ssm_parameter_prefix  = "MongoDB"
  custom_domain         = false
  project_name          = "irs-mongo"
}


<!-- BEGIN_TF_DOCS -->
## Requirements

No requirements.

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | n/a |
| <a name="provider_http"></a> [http](#provider\_http) | n/a |
| <a name="provider_random"></a> [random](#provider\_random) | n/a |
| <a name="provider_template"></a> [template](#provider\_template) | n/a |
| <a name="provider_tls"></a> [tls](#provider\_tls) | n/a |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [aws_iam_instance_profile.mongo-instance-profile](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_instance_profile) | resource |
| [aws_iam_role.mongo-role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role) | resource |
| [aws_iam_role_policy.ec2-describe-instance-policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy) | resource |
| [aws_instance.mongo_primary](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance) | resource |
| [aws_instance.mongo_secondary](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance) | resource |
| [aws_key_pair.ssh_key](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/key_pair) | resource |
| [aws_security_group.mongo_sg](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group) | resource |
| [aws_ssm_parameter.mongodb_admin_db](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ssm_parameter) | resource |
| [aws_ssm_parameter.mongodb_admin_password](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ssm_parameter) | resource |
| [aws_ssm_parameter.mongodb_admin_user](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ssm_parameter) | resource |
| [random_string.autogenerated_password](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/string) | resource |
| [tls_private_key.ssh_private_key](https://registry.terraform.io/providers/hashicorp/tls/latest/docs/resources/private_key) | resource |
| [aws_iam_policy_document.instance-assume-role-policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_vpc.mongodb_vpc](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/vpc) | data source |
| [http_http.terraform_server_ip](https://registry.terraform.io/providers/hashicorp/http/latest/docs/data-sources/http) | data source |
| [template_file.userdata](https://registry.terraform.io/providers/hashicorp/template/latest/docs/data-sources/file) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_custom_domain"></a> [custom\_domain](#input\_custom\_domain) | n/a | `bool` | `false` | no |
| <a name="input_domain_name"></a> [domain\_name](#input\_domain\_name) | n/a | `string` | `".test.internal"` | no |
| <a name="input_environment"></a> [environment](#input\_environment) | n/a | `string` | `"env"` | no |
| <a name="input_instance_user"></a> [instance\_user](#input\_instance\_user) | n/a | `string` | `"ubuntu"` | no |
| <a name="input_key_name"></a> [key\_name](#input\_key\_name) | n/a | `any` | n/a | yes |
| <a name="input_mongo_ami"></a> [mongo\_ami](#input\_mongo\_ami) | n/a | `string` | `"ami-0149b2da6ceec4bb0"` | no |
| <a name="input_mongo_database"></a> [mongo\_database](#input\_mongo\_database) | n/a | `any` | n/a | yes |
| <a name="input_mongo_subnet_id"></a> [mongo\_subnet\_id](#input\_mongo\_subnet\_id) | n/a | `any` | n/a | yes |
| <a name="input_mongo_username"></a> [mongo\_username](#input\_mongo\_username) | n/a | `string` | `"admin"` | no |
| <a name="input_num_secondary_nodes"></a> [num\_secondary\_nodes](#input\_num\_secondary\_nodes) | n/a | `number` | `2` | no |
| <a name="input_primary_node_type"></a> [primary\_node\_type](#input\_primary\_node\_type) | n/a | `any` | n/a | yes |
| <a name="input_project_name"></a> [project\_name](#input\_project\_name) | n/a | `string` | `"dummy_prj"` | no |
| <a name="input_region"></a> [region](#input\_region) | n/a | `any` | n/a | yes |
| <a name="input_replica_set_name"></a> [replica\_set\_name](#input\_replica\_set\_name) | n/a | `string` | `"mongoRs"` | no |
| <a name="input_secondary_node_type"></a> [secondary\_node\_type](#input\_secondary\_node\_type) | n/a | `any` | n/a | yes |
| <a name="input_ssm_parameter_prefix"></a> [ssm\_parameter\_prefix](#input\_ssm\_parameter\_prefix) | n/a | `string` | `"MongoDB"` | no |
| <a name="input_vpc_id"></a> [vpc\_id](#input\_vpc\_id) | n/a | `any` | n/a | yes |

## Outputs

No outputs.
<!-- END_TF_DOCS -->
## Authors

Module managed by [TO THE NEW Pvt. Ltd.](https://github.com/tothenew)

## License

Apache 2 Licensed. See [LICENSE](https://github.com/tothenew/terraform-aws-mongodb/blob/main/LICENSE) for full details.
